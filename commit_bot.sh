#!/bin/bash
set -e

# Configuração do Git
git config user.name "Luizfelipereal007"
git config user.email "lmarianobonfim@gmail.com"

# Texto que será desenhado no Contribution Graph
texto="feliz-2024"  # <<< Texto final

# Mapa de pixels 5x7
declare -A letras=(
  ["a"]="01110 10001 10001 11111 10001 10001 10001"
  ["b"]="11110 10001 10001 11110 10001 10001 11110"
  ["c"]="01111 10000 10000 10000 10000 10000 01111"
  ["d"]="11110 10001 10001 10001 10001 10001 11110"
  ["e"]="11111 10000 10000 11110 10000 10000 11111"
  ["f"]="11111 10000 10000 11110 10000 10000 10000"
  ["g"]="01111 10000 10000 10111 10001 10001 01111"
  ["h"]="10001 10001 10001 11111 10001 10001 10001"
  ["i"]="11111 00100 00100 00100 00100 00100 11111"
  ["j"]="00111 00010 00010 00010 00010 10010 01100"
  ["k"]="10001 10010 10100 11000 10100 10010 10001"
  ["l"]="10000 10000 10000 10000 10000 10000 11111"
  ["m"]="10001 11011 10101 10001 10001 10001 10001"
  ["n"]="10001 11001 10101 10011 10001 10001 10001"
  ["o"]="01110 10001 10001 10001 10001 10001 01110"
  ["p"]="11110 10001 10001 11110 10000 10000 10000"
  ["q"]="01110 10001 10001 10001 10101 10010 01101"
  ["r"]="11110 10001 10001 11110 10100 10010 10001"
  ["s"]="01111 10000 10000 01110 00001 00001 11110"
  ["t"]="11111 00100 00100 00100 00100 00100 00100"
  ["u"]="10001 10001 10001 10001 10001 10001 01110"
  ["v"]="10001 10001 10001 10001 10001 01010 00100"
  ["w"]="10001 10001 10001 10001 10101 11011 10001"
  ["x"]="10001 10001 01010 00100 01010 10001 10001"
  ["y"]="10001 10001 01010 00100 00100 00100 00100"
  ["z"]="11111 00001 00010 00100 01000 10000 11111"
  ["0"]="01110 10011 10101 11001 10011 10001 01110"
  ["1"]="00100 01100 00100 00100 00100 00100 01110"
  ["2"]="01110 10001 00001 00110 01000 10000 11111"
  ["3"]="11111 00010 00100 00010 00001 10001 01110"
  ["4"]="00010 00110 01010 10010 11111 00010 00010"
  ["5"]="11111 10000 11110 00001 00001 10001 01110"
  ["6"]="00110 01000 10000 11110 10001 10001 01110"
  ["7"]="11111 00001 00010 00100 01000 01000 01000"
  ["8"]="01110 10001 10001 01110 10001 10001 01110"
  ["9"]="01110 10001 10001 01111 00001 00010 01100"
  ["-"]="00000 00000 00000 11111 00000 00000 00000"
)

# Primeiro domingo de 2024
start_date="2023-12-31"

add_days() {
  date -d "$1 +$2 days" "+%Y-%m-%d"
}

current_col=0

for ((i=0; i<${#texto}; i++)); do
  letra="${texto:$i:1}"

  if [[ "$letra" == " " || "$letra" == "-" ]]; then
    ((current_col+=2))
    continue
  fi

  mapa="${letras[$letra]}"
  if [ -z "$mapa" ]; then
    echo "Caractere '$letra' não mapeado, pulando..."
    ((current_col+=6))
    continue
  fi

  row=0
  for line in $mapa; do
    for ((pos=0; pos<${#line}; pos++)); do
      pixel="${line:$pos:1}"
      if [ "$pixel" == "1" ]; then
        days=$(( current_col*7 + row ))
        commit_date=$(add_days "$start_date" "$days")
        GIT_AUTHOR_DATE="$commit_date 12:00:00" GIT_COMMITTER_DATE="$commit_date 12:00:00" git commit --allow-empty -m "Pixel $letra em $commit_date"
      fi
    done
    ((row++))
  done

  ((current_col+=6))
done

git push
